<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uno Bookstore â€” QR Check-in</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="page-qr">

  <div class="qr-container">
    <div class="qr-card">
      <span class="logo-icon">ğŸ“š</span>
      <h1>Uno Bookstore</h1>
      <p class="subtitle">QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</p>

      <!-- QR Code Display -->
      <div class="qr-display" id="qr-display">
        <p class="qr-loading">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...</p>
      </div>

      <!-- URL Display -->
      <div class="qr-url" id="qr-url"></div>

      <!-- Instructions -->
      <div class="qr-instructions">
        <h3>ä½¿ã„æ–¹</h3>
        <ol>
          <li>ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹</li>
          <li>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãŒé–‹ã</li>
          <li>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãƒ»ã‚«ãƒ©ãƒ¼ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ»ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ</li>
          <li>ã€Œãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</li>
        </ol>
      </div>

      <!-- Custom URL -->
      <div class="qr-custom">
        <label>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³URLï¼ˆç·¨é›†å¯èƒ½ï¼‰</label>
        <input type="url" id="custom-url" class="nickname-input" placeholder="https://your-domain.com/index.html">
        <button class="btn-submit btn-generate" id="btn-generate">QRã‚³ãƒ¼ãƒ‰ã‚’å†ç”Ÿæˆ</button>
      </div>

      <!-- Navigation -->
      <div style="text-align:center; margin-top:1.5rem;">
        <a href="index.html" class="nav-link">â† ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³</a>
        <span style="margin:0 0.5rem; color:var(--color-text-light);">|</span>
        <a href="screen.html" class="nav-link">ğŸ“º ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</a>
      </div>
    </div>
  </div>

  <!-- QR Code Library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

  <script>
    (function () {
      'use strict';

      const qrDisplay = document.getElementById('qr-display');
      const qrUrlEl = document.getElementById('qr-url');
      const customUrlInput = document.getElementById('custom-url');
      const btnGenerate = document.getElementById('btn-generate');

      function getDefaultURL() {
        const loc = window.location;
        return loc.origin + loc.pathname.replace(/qr\.html$/, 'index.html');
      }

      function generateQR(url) {
        qrDisplay.innerHTML = '';

        const canvas = document.createElement('canvas');
        qrDisplay.appendChild(canvas);

        QRCode.toCanvas(canvas, url, {
          width: 280,
          margin: 2,
          color: {
            dark: '#2C3E50',
            light: '#FFFFFF',
          },
          errorCorrectionLevel: 'M',
        }, function (error) {
          if (error) {
            qrDisplay.innerHTML = '<p class="qr-loading">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
            console.error(error);
          }
        });

        qrUrlEl.textContent = url;
      }

      // Initial generation
      const defaultURL = getDefaultURL();
      customUrlInput.value = defaultURL;
      generateQR(defaultURL);

      // Regenerate on button click
      btnGenerate.addEventListener('click', () => {
        const url = customUrlInput.value.trim();
        if (url) {
          generateQR(url);
        }
      });

      // Also regenerate on Enter key
      customUrlInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          btnGenerate.click();
        }
      });

    })();
  </script>
</body>
</html>
